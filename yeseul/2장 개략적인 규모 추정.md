시스템 설계 면접을 볼 때, 때로는 시스템 용량이나 성능 요구사항을 개략적으로 추정해보라는 요구를 받게 됩니다.

구글의 시니어 펠로 제프 딘이 말하길, “개략적인 규모 추정은 보편적으로 통용되는 성능 수치상에서 사고 실험을 행하여 추정치를 계산하는 행위로서, **어떤 설계가 요구사항에 부합할 것인지 보기 위한 것이다**.” 라고 했습니다.

개략적 규모 추정을 효과적으로 해 내려면 규모 확장성을 표현하는데 필요한 기본기에 능숙해야합니다. 특히 2의 제곱수나 응답지연 값, 그리고 가용성에 관계된 수치들을 기본적으로 잘 이해하고 있어야 합니다.

## 2의 제곱수

분산 시스템에서 다루는 데이터의 양은 엄청나게 커질 수 있으나 그 계산법은 기본을 크게 벗어나지 않습니다.

제대로 된 계산 결과를 얻으려면 **데이터 볼륨의 단위를 2의 제곱수로 표현하면 어떻게 되는지를 우선 알아야 합니다.**

최소 단위는 1바이트이고, 8비트로 구성됩니다. ASCII 문자 하나가 차지하는 메모리 크기가 1바이트인거죠.

아래는 흔히 쓰이는 데이터 볼륨 단위들입니다.

![image](https://github.com/SPRING-STUDY-2023/System-Design-Interview/assets/68415644/8ca4b5b6-b901-4864-8b23-1f347b6092da)


## 모든 프로그래머가 알아야 하는 응답지연 값

구글의 제프 딘은 2010년에 통상적인 컴퓨터에서 구현된 연산들의 응답지연값을 공개한 바 있습니다.

### 지연 시간 ?

컴퓨팅에서 "대기 시간"은 일종의 지연을 나타냅니다. 이는 일반적으로 다양한 이유로 인해 발생할 수 있는 데이터 전송 또는 처리 지연을 의미합니다.

`Note: 1 ns = 1 * 10^-9 sec`

이들 가운데 몇몇은 더 빠른 컴퓨터가 등장하면서 더이상 유효하지 않게 되었지만, 아직도 이 수치들은 컴퓨터 연산들의 처리 속도가 어느 정도인지 짐작할 수 있게 해줍니다.

![image](https://github.com/SPRING-STUDY-2023/System-Design-Interview/assets/68415644/2adb79a3-e952-4a70-8437-bbe26998422d)


아래는 1990년부터 2020년까지 응답 지연 수치가 어떻게 변하는가에 대한 표입니다.

![image](https://github.com/SPRING-STUDY-2023/System-Design-Interview/assets/68415644/1c43374c-fd73-4e4c-985b-1876fd84622b)


딘 박사가 나열한 이 수들을 알기 쉽게 시각화하기 위해, 한 구글 엔지니어가 개발한 도구가 있습니다.

이 도구가 보여주는 수치에는 최근 기술 동향이 반영되어 있다. 아래 그림은 그 도구를 이용하여 2020년 기준으로 시각화한 수치입니다.

![image](https://github.com/SPRING-STUDY-2023/System-Design-Interview/assets/68415644/36dd5157-be85-4a7c-b513-4bf83c6e1f0f)


위의 수치들을 분석하면 아래와 같은 결론이 나옵니다.

- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색(seek)은 가능한 한 피해라.
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축해라.
- 데이터 센터는 보통 여러 지역에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.
- 쓰기 연산은 읽기보다 40배 이상 비싸다(느리다).
- 늘어날 쓰기 연산을 대비해 설계하자.

## 가용성에 관계된 수치들

고가용성은 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어입니다.

![image](https://github.com/SPRING-STUDY-2023/System-Design-Interview/assets/68415644/8707d5af-288d-435c-b209-eab2614ef58d)


고가용성을 표현하는 값은 퍼센트로 표현하는데, 100%는 시스테이 단 한번도 중단된 적이 없음을 의미합니다. 대부분의 서비스는 99%에서 100%의 값을 가집니다.

SLA는 서비스 사업자와 고객 사이에 맺어진 합의를 의미합니다. 이 합의에는 서비스 사업자가 제공하는 서비스의 가용시간(uptime)이 공식적으로 기술 되어 있습니다.

아마존, 구글, 그리고 마이크로소프트 같은 사업자는 99% 이상의 SLA를 제공합니다. 가용시간은 관습적으로 9를 사용해 표시합니다. 즉, 9가 많을수록 좋은 것이죠.

아래 표는 9의 개수와 시스템 장애 시간(downtime) 사이의 관계입니다.

![image](https://github.com/SPRING-STUDY-2023/System-Design-Interview/assets/68415644/eb2d2342-97b5-4ebe-b63d-7c8346e713d6)


## 예제: 트위터 QPS와 저장소 요구량 추정

### 가정

- 월간 능동 사용자(mau): 3억명
- 50%의 사용자가 매일 사용
- 각 사용자는 매일 2건의 트윗을 올린다. (평균)
- 미디어를 포함하는 트윗은 10% 정도이다.
- 데이터는 5년간 보관된다.

### 추정

QPS(Query Per Second) 추정치

- 일간 능동 사용자 = 월간 능동 사용자 * 50% = 1.5억
- QPS = 일간 능동 사용자 *2트윗 / (24시간* 3600초) = 약 3500
- 최대 QPS = 2 * QPS = 약 7000

### 미디어 저장을 위한 저장소 요구량

- 평균 트윗 크기
    - tweet_id: 64바이트
    - 텍스트에 140바이트
    - 미디어에 1MB
- 미디어 저장소 요구량: 1.5억 *2* 10% * 1MB = 30TB/일
- 5년간 미디어를 보관하기 위한 저장소 요구량: 30TB *365* 5 = 약 55PB

# 팁

개략적인 규모 추정하는 데에서 가장 중요한 것은 **문제를 풀어나가는 절차 입니다.**

올바른 **절차**를 밟느냐가 결과를 내는 것보다 중요합니다. 면접자가 보고자하는 것은 우리의 문제해결능력이기 때문이죠. 이에 도움이 될 몇 가지 팁을 공유하니 참고하면 좋을 것 같습니다.

- 근사치를 활용한 계산
    - 적절한 근사치를 활용하여 시간을 절약하자.
- 가정(assumption)들을 미리 적어두어라
- 단위(unit)을 붙여라 스스로도 헷갈리게 되기 쉬우니 단위를 붙이는 습관을 들이자.
- 많이 출제되는 개략적 규모 추정문제
    - QPS
    - 최대 QPS
    - 저장소 요구량
    - 캐시 요구량
    - 서버 수
