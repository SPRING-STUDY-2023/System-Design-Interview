# 13장 검색어 자동완성 시스템
- 검색어 자동완성은 많은 제품에 중요하게 사용되는 기능이다.
- 가장 많이 이용된 검색어 k개를 자동완성하여 출력하는 시스템을 설계해 보도록 하자.

<br/>

## 1️⃣ 문제 이해 및 설계 범위 확정
```
지원자: 사용자가 입력하는 단어는 자동완성될 검색어의 첫 부분이어야 하나요? 아니면 중간 부분이 될 수도 있습니까?
면접관: 첫 부분으로 한정하겠습니다.

지원자: 몇 개의 자동완성 검색어가 표시되어야 합니까?
면접관: 5개입니다.

지원자: 자동완성 검색어 5개를 고르는 기준은 무엇입니까?
면접관: 질이 빈도에 따라 정해지는 검색어 인기 순위를 기준으로 삼겠습니다.

지원자: 맞춤법 검사 기능도 제공해야 합니까?
면접관: 아뇨. 맞춤법 검사나 자동수정은 지원하지 않습니다.

지원자: 질의는 영어입니까?
면접관: 네. 하지만 시간이 허락한다면 다국어 지원을 생각해도 좋습니다.

지원자: 대문자나 특수 문자 처리도 해야 합니까?
면접관: 아뇨. 모든 질의는 영어 소문자로 이루어진다고 가정하겠습니다.

지원자: 얼마나 많은 사용자를 지원해야 합니까?
면접관: 일간 능동 사용자(DAU) 기준으로 천만명입니다.
```

<br/>

### 요구사항
- 빠른 응답 속도 (100밀리초 이내)
- 연관성 (입력 단어와 연관된 것)
- 정렬 (인기도 등의 순위 모델에 의해 정렬)
- 규모 확장성 (많은 트래픽을 감당할 수 있도록 확장 가능해야 함)
- 고가용성 (시스템은 계속 사용 가능해야 함)

<br/>

### 개략적 규모 추정
- 일간 능동 사용자(DAU)는 천만 명으로 가정한다.
- 평균적으로 한 사용자는 매일 10건의 검색을 수행한다고 가정한다.
- 질의할 때마다 평균적으로 20바이트의 데이터를 입력한다고 가정한다.
  - 문자 인코딩 방법: ASCII
  - 질의문은 평균적으로 4개 단어로, 각 단어는 평균적으로 5글자로 구성한다고 가정
  - 질의당 평균 4 * 5 = 20
- 글자를 입력할 때마다 자동완성 BE에 요청 전송, 평균적으로 1회 검색당 20건의 요청 전달
- 대략 초당 24,000건의 질의 발생 (10,000,000 사용자 * 10질의 / 일 * 20자 / 24시간 / 3600초)
- 최대 QPS = QPS * 2 = 대략 48,000
- 질의 가운데 20% 정도는 신규 검색어라고 가정 (대략 0.4GB 정도 매일 신규 데이터 추가)

<br/>

## 2️⃣ 개략적 설계안 제시 및 동의 구하기

### 데이터 수집 서비스
- 사용자가 입력한 질의를 실시간으로 수집하는 시스템
- 빈도 테이블(질의문과 사용빈도를 저장)이 있을 때, 사용자가 검색함에 따라 테이블은 주기적으로 업데이트된다.

<br/>

<img width="550" alt="image" src="https://github.com/SPRING-STUDY-2023/System-Design-Interview/assets/55437339/eb47052a-ec36-474a-9ea4-0202341a2daf" />

<br/>

### 질의 서비스
- 주어진 질의에 5개의 인기 검색어를 정렬해 내놓는 서비스
- 데이터 양이 적을 때는 나쁘지 않지만, 데이터가 많아지면 DB 병목이 될 수 있다.

<br/>

|query|frequency|
|---|---|
|twitter|35|
|twitch|29|
|twillight|25|
|twin peak|21|
|twitch prime|18|
|twitter search|14|
|twillo|10|
|twin peak of|8|

🔼 빈도 테이블
- query: 질의문을 저장하는 필드
- frequency: 질의문이 사용된 빈도를 저장하는 필드
- 빈도 테이블에 기록된 수치를 사용해 상위 5개의 검색어를 반환한다.
  - `tw` 검색: twitter, twitch, twillight, twin peak, twitch prime

<br/>

## 3️⃣ 상세 설계
### 트라이 자료구조
